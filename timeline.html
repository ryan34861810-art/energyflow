<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>èƒ½æºæµè¦–è¦ºåŒ– - Timeline</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      margin: 0;
      background-color: #f5f5f5;
    }
    #timeline-container {
      padding: 15px 30px;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    #timeline-container label {
      white-space: nowrap;
    }
    #yearSlider {
      flex: 1;
      min-width: 200px;
    }
    #yearDisplay {
      font-size: 20px;
      font-weight: bold;
      min-width: 60px;
    }
    #stats-container {
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      position: relative;
    }
    #stats-year {
      text-align: center;
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 15px;
      opacity: 0.95;
    }
    #debug-info {
      position: fixed;
      top: 100px;
      right: 20px;
      background: rgba(0,0,0,0.9);
      color: #0f0;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      cursor: move;
      max-width: 400px;
      max-height: 500px;
      overflow-y: auto;
    }
    #debug-info div {
      margin: 5px 0;
    }
    #debug-header {
      font-weight: bold;
      margin-bottom: 10px;
      border-bottom: 1px solid #0f0;
      padding-bottom: 5px;
      cursor: move;
    }
    #debug-failed {
      color: #ff6b6b;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 10px;
      padding: 5px;
      background: rgba(255,0,0,0.1);
      border-radius: 4px;
    }
    #debug-yearly {
      color: #ffa500;
      max-height: 150px;
      overflow-y: auto;
      margin-top: 10px;
      padding: 5px;
      background: rgba(255,165,0,0.1);
      border-radius: 4px;
      font-size: 11px;
    }
    #debug-sample {
      color: #00bfff;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 10px;
      padding: 5px;
      background: rgba(0,191,255,0.1);
      border-radius: 4px;
      font-size: 11px;
    }
    #debug-filter-detail {
      color: #ff69b4;
      max-height: 250px;
      overflow-y: auto;
      margin-top: 10px;
      padding: 5px;
      background: rgba(255,105,180,0.1);
      border-radius: 4px;
      font-size: 10px;
    }
    #stats-grid {
      display: flex;
      justify-content: space-around;
      align-items: center;
      gap: 30px;
    }
    .stat-item {
      text-align: center;
      flex: 1;
    }
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      margin: 5px 0;
    }
    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }
    #chart {
      width: 100%;
      height: 80vh;
    }
    .node rect {
      stroke: #333;
      cursor: pointer;
    }
    .node text {
      font-size: 14px;
      pointer-events: all;
      cursor: pointer;
    }
    .link {
      fill: none;
      stroke-opacity: 0.4;
    }
    .link:hover {
      stroke-opacity: 0.7;
    }
    #tooltip {
      position: absolute;
      background: white;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
      display: none;
      pointer-events: none;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>

  <div id="timeline-container">
    <label for="yearSlider">å¹´ä»½ï¼š</label>
    <input type="range" id="yearSlider" min="1984" max="2024" value="1984" step="1" />
    <span id="yearDisplay">1984</span>
  </div>

  <div id="stats-container">
    <div id="stats-year">1984</div>
    <div id="stats-grid">
      <div class="stat-item">
        <div class="stat-label">ç¸½èƒ½æºä¾›çµ¦</div>
        <div class="stat-value" id="totalEnergy">-</div>
        <div class="stat-label">ktoe</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ç…¤ç‚­ä½”æ¯”</div>
        <div class="stat-value" id="coalPercent">-</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">å†ç”Ÿèƒ½æºä½”æ¯”</div>
        <div class="stat-value" id="renewablePercent">-</div>
      </div>
    </div>
  </div>

  <div id="chart"></div>
  <div id="tooltip"></div>
  
  <div id="debug-info">
    <div id="debug-header">ğŸ” æ¸¬è©¦è³‡è¨Š (å¯æ‹–å‹•)</div>
    <div>ç•¶å‰è®€å–å¹´ä»½: <span id="debug-year">-</span></div>
    <div>åŸå§‹è³‡æ–™ç­†æ•¸: <span id="debug-raw-count">-</span></div>
    <div>ç¯©é¸å¾Œè³‡æ–™ç­†æ•¸: <span id="debug-count">-</span></div>
    <div>ç¯€é»æ•¸: <span id="debug-nodes">-</span></div>
    <div>é€£çµæ•¸: <span id="debug-links">-</span></div>
    <div>å·²è¼‰å…¥: <span id="debug-loaded">0</span></div>
    <div id="debug-filter-detail"></div>
    <div id="debug-sample"></div>
    <div id="debug-failed"></div>
    <div id="debug-yearly"></div>
  </div>

<script>
const departments = ["å·¥æ¥­éƒ¨é–€","é‹è¼¸éƒ¨é–€","è¾²æ¥­éƒ¨é–€","æœå‹™æ¥­éƒ¨é–€","ä½å®…éƒ¨é–€","è½‰æ›æ•ˆç‡æå¤±"];
const energySources = ["ç…¤åŠç…¤ç”¢å“","åŸæ²¹åŠçŸ³æ²¹ç”¢å“","å¤©ç„¶æ°£","å†ç”Ÿèƒ½æº"];
const chart = d3.select("#chart");
const tooltip = d3.select("#tooltip");
const width = window.innerWidth;
const height = window.innerHeight * 0.8;
const svg = chart.append("svg").attr("width", width).attr("height", height);

const sankey = d3.sankey()
  .nodeWidth(20)
  .nodePadding(20)
  .extent([[150, 50], [width - 150, height - 50]])
  .nodeAlign(d3.sankeyLeft)
  .nodeSort((a, b) => {
    // å…ˆæŒ‰å±¤ç´šæ’åº
    if (a.layer !== b.layer) return a.layer - b.layer;
    // åŒå±¤ç´šæŒ‰åç¨±æ’åº
    return a.name.localeCompare(b.name);
  });

// é¡è‰²å°æ‡‰è¡¨
const colorMap = {
  "ç…¤åŠç…¤ç”¢å“": "#444",
  "åŸæ²¹åŠçŸ³æ²¹ç”¢å“": "#a0522d",
  "å¤©ç„¶æ°£": "#4682b4",
  "å†ç”Ÿèƒ½æº": "#2e8b57",
  "é›»åŠ›ç³»çµ±": "#1e90ff",
  "åŸæ²¹åŠçŸ³æ²¹çš„è£½é€ èˆ‡åˆ†éŠ·": "#8b4513",
  "å·¥æ¥­éƒ¨é–€": "#1f77b4",
  "é‹è¼¸éƒ¨é–€": "#ff7f0e",
  "ä½å®…éƒ¨é–€": "#2ca02c",
  "æœå‹™æ¥­éƒ¨é–€": "#d62728",
  "è¾²æ¥­éƒ¨é–€": "#9467bd",
  "è½‰æ›æ•ˆç‡æå¤±": "#7f7f7f"
};

// URL
const csvBase = "https://raw.githubusercontent.com/ryan34861810-art/energyflow/main/";
const years = d3.range(1984, 2025);
const fileMap = Object.fromEntries(years.map(y => [y, `${csvBase}template${String(y-1911).padStart(3,"0")}.csv`]));
let dataByYear = {};

async function loadAllCSV() {
  let loadedCount = 0;
  const failedYears = [];
  const yearlyInfo = [];
  
  d3.select("#debug-failed").html("<strong>è¼‰å…¥ä¸­...</strong>");
  
  for (const y of years) {
    const rocYear = y - 1911;
    const urls = [
      `${csvBase}template${String(rocYear).padStart(3,"0")}.csv`,
      `${csvBase}template${rocYear}.csv`
    ];
    
    let loaded = false;
    for (const url of urls) {
      try {
        // å˜—è©¦ä¸åŒç·¨ç¢¼
        const response = await fetch(url);
        if (!response.ok) continue;
        
        // å…ˆå˜—è©¦ UTF-8
        let text = await response.text();
        
        // æª¢æŸ¥æ˜¯å¦æœ‰äº‚ç¢¼ï¼ˆBig5 èª¤è®€ç‚º UTF-8 æœƒæœ‰ç‰¹å®šç¬¦è™Ÿï¼‰
        if (text.includes('ï¿½') || text.match(/[\u0080-\u009F]/)) {
          // é‡æ–°ç”¨ Big5 è®€å–
          const blob = await (await fetch(url)).blob();
          text = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.readAsText(blob, 'Big5');
          });
        }
        
        // è§£æ CSV
        const data = d3.csvParse(text);
        
        if (data && data.length > 0) {
          dataByYear[y] = data;
          loadedCount++;
          loaded = true;
          
          const filtered = filterDepartmentLevel(data);
          const status = filtered.length > 0 ? "âœ“" : "âš ï¸";
          yearlyInfo.push(`${status} ${y}: åŸå§‹${data.length}ç­† â†’ ç¯©é¸${filtered.length}ç­†`);
          break;
        }
      } catch (e) {
        // ç¹¼çºŒå˜—è©¦
      }
    }
    
    if (!loaded) {
      failedYears.push(y);
      yearlyInfo.push(`âœ— ${y}: è¼‰å…¥å¤±æ•—`);
    }
    
    d3.select("#debug-loaded").text(`${loadedCount} / ${years.length}`);
  }
  
  // é¡¯ç¤ºå¤±æ•—åˆ—è¡¨
  if (failedYears.length > 0) {
    const failedList = failedYears.map(y => `${y}(${y-1911})`).join(", ");
    d3.select("#debug-failed").html(`<strong>è¼‰å…¥å¤±æ•— (${failedYears.length}å€‹):</strong><br/>${failedList}`);
  } else {
    d3.select("#debug-failed").html("<strong style='color:#0f0'>âœ“ å…¨éƒ¨è¼‰å…¥æˆåŠŸ</strong>");
  }
  
  // é¡¯ç¤ºæ¯å¹´è©³ç´°è³‡è¨Š
  d3.select("#debug-yearly").html(`<strong>å„å¹´ä»½ç‹€æ…‹:</strong><br/>${yearlyInfo.join("<br/>")}`);
  
  updateChart(1984);
}

// æ‹–å‹•åŠŸèƒ½
let isDragging = false;
let currentX, currentY, initialX, initialY;

const debugPanel = document.getElementById("debug-info");

debugPanel.addEventListener("mousedown", (e) => {
  isDragging = true;
  initialX = e.clientX - debugPanel.offsetLeft;
  initialY = e.clientY - debugPanel.offsetTop;
});

document.addEventListener("mousemove", (e) => {
  if (isDragging) {
    e.preventDefault();
    currentX = e.clientX - initialX;
    currentY = e.clientY - initialY;
    debugPanel.style.left = currentX + "px";
    debugPanel.style.top = currentY + "px";
    debugPanel.style.right = "auto";
  }
});

document.addEventListener("mouseup", () => {
  isDragging = false;
});

function filterDepartmentLevel(data) {
  const logs = [];
  const filtered = data.filter(d => {
    if (!d.Source || !d.Target) {
      logs.push(`âœ— ç©ºå€¼: ${d.Source || '?'} â†’ ${d.Target || '?'}`);
      return false;
    }
    
    // ç›®æ¨™æ˜¯éƒ¨é–€
    if (departments.includes(d.Target)) {
      logs.push(`âœ“ éƒ¨é–€: ${d.Source} â†’ ${d.Target}`);
      return true;
    }
    
    // ç›®æ¨™åŒ…å«"ç³»çµ±"æˆ–"è£½é€ èˆ‡åˆ†éŠ·"æˆ–"ç”Ÿç”¢èˆ‡åˆ†éŠ·"
    if (d.Target.includes("ç³»çµ±") || 
        d.Target.includes("è£½é€ èˆ‡åˆ†éŠ·") || 
        d.Target.includes("ç”Ÿç”¢èˆ‡åˆ†éŠ·")) {
      logs.push(`âœ“ ä¸­é–“å±¤: ${d.Source} â†’ ${d.Target}`);
      return true;
    }
    
    // ä¾†æºæ˜¯é›»åŠ›ç³»çµ±ï¼ˆä¿ç•™æ‰€æœ‰é›»åŠ›ç³»çµ±çš„æµå‘ï¼‰
    if (d.Source.includes("é›»åŠ›ç³»çµ±") || d.Source.includes("ç³»çµ±")) {
      logs.push(`âœ“ é›»åŠ›ç³»çµ±: ${d.Source} â†’ ${d.Target}`);
      return true;
    }
    
    // ä¾†æºæ˜¯ä¸»è¦èƒ½æº
    const sourceKeywords = ["ç…¤", "åŸæ²¹", "çŸ³æ²¹", "å¤©ç„¶æ°£", "æ ¸èƒ½", "æ°´åŠ›", "åœ°ç†±", "å¤ªé™½", "é¢¨åŠ›", "ç”Ÿè³ª"];
    if (sourceKeywords.some(keyword => d.Source.includes(keyword))) {
      logs.push(`âœ“ èƒ½æº: ${d.Source} â†’ ${d.Target}`);
      return true;
    }
    
    logs.push(`âœ— ç¯©æ‰: ${d.Source} â†’ ${d.Target}`);
    return false;
  });
  
  // é¡¯ç¤ºç¯©é¸æ—¥èªŒï¼ˆåªé¡¯ç¤ºå‰20ç­†å’Œè¢«ç¯©æ‰çš„å‰10ç­†ï¼‰
  const kept = logs.filter(l => l.startsWith('âœ“')).slice(0, 20);
  const removed = logs.filter(l => l.startsWith('âœ—')).slice(0, 10);
  d3.select("#debug-filter-detail").html(
    `<strong>ä¿ç•™ (å‰20ç­†):</strong><br/>${kept.join('<br/>')}<br/><br/>` +
    `<strong>ç¯©æ‰ (å‰10ç­†):</strong><br/>${removed.join('<br/>')}`
  );
  
  return filtered;
}

function buildSankeyData(data) {
  const nodes = Array.from(new Set(data.flatMap(d => [d.Source, d.Target]))).map(name => ({ name }));
  const nodeMap = new Map(nodes.map((d, i) => [d.name, i]));
  const links = data.map(d => ({
    source: nodeMap.get(d.Source),
    target: nodeMap.get(d.Target),
    value: +d["Value(kKLOE)"]
  }));

  // åˆ†å±¤æ§åˆ¶
  nodes.forEach(n => {
    // èƒ½æºä¾†æºå±¤
    if (energySources.some(s => n.name.includes(s.substring(0, 3))) ||
        n.name.includes("æ ¸èƒ½") || n.name.includes("æ°´åŠ›") || 
        n.name.includes("åœ°ç†±") || n.name.includes("å¤ªé™½") || 
        n.name.includes("é¢¨åŠ›") || n.name.includes("ç”Ÿè³ª")) {
      n.layer = 0;
    } 
    // éƒ¨é–€å±¤
    else if (departments.includes(n.name)) {
      n.layer = 2;
    } 
    // ä¸­é–“å±¤ï¼ˆç³»çµ±ã€è£½é€ èˆ‡åˆ†éŠ·ç­‰ï¼‰
    else {
      n.layer = 1;
    }
  });

  return { nodes, links };
}

function updateChart(year) {
  d3.select("#yearDisplay").text(year);
  d3.select("#stats-year").text(year);
  d3.select("#debug-year").text(year);
  
  svg.selectAll("*").remove();

  const rawData = dataByYear[year] || [];
  const currentData = filterDepartmentLevel(rawData);
  const prevData = filterDepartmentLevel(dataByYear[year - 1] || []);
  
  d3.select("#debug-raw-count").text(rawData.length);
  d3.select("#debug-count").text(currentData.length);

  // é¡¯ç¤ºè³‡æ–™æ¨£æœ¬
  if (rawData.length > 0) {
    const sample = rawData.slice(0, 3);
    const sampleText = sample.map(d => 
      `${d.Source || '?'} â†’ ${d.Target || '?'} (${d["Value(kKLOE)"] || '?'})`
    ).join("<br/>");
    
    const uniqueSources = [...new Set(rawData.map(d => d.Source))].slice(0, 10).join(", ");
    const uniqueTargets = [...new Set(rawData.map(d => d.Target))].slice(0, 10).join(", ");
    
    d3.select("#debug-sample").html(
      `<strong>è³‡æ–™æ¨£æœ¬:</strong><br/>${sampleText}<br/><br/>` +
      `<strong>ä¾†æºé¡å‹:</strong><br/>${uniqueSources}<br/><br/>` +
      `<strong>ç›®æ¨™é¡å‹:</strong><br/>${uniqueTargets}`
    );
  }

  if (!currentData.length) {
    d3.select("#debug-nodes").text("0");
    d3.select("#debug-links").text("0");
    console.warn(`${year}: ç¯©é¸å¾Œç„¡è³‡æ–™å¯é¡¯ç¤º`);
    return;
  }

  // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
  const allData = dataByYear[year] || [];
  
  // ç¸½èƒ½æºä¾›çµ¦ï¼šæ‰€æœ‰èƒ½æºä¾†æºçš„ç¸½å’Œ
  const energySourceKeywords = ["ç…¤", "åŸæ²¹", "çŸ³æ²¹", "å¤©ç„¶æ°£", "æ ¸èƒ½", "æ°´åŠ›", "åœ°ç†±", "å¤ªé™½", "é¢¨åŠ›", "ç”Ÿè³ª", "æ½®æ±"];
  const totalEnergy = d3.sum(allData.filter(d => 
    energySourceKeywords.some(keyword => d.Source && d.Source.includes(keyword))
  ), d => +d["Value(kKLOE)"]);
  
  // ç…¤ç‚­ä½”æ¯”ï¼šæ‰€æœ‰åŒ…å«"ç…¤"çš„ä¾†æº
  const coalEnergy = d3.sum(allData.filter(d => 
    d.Source && d.Source.includes("ç…¤")
  ), d => +d["Value(kKLOE)"]);
  
  // å†ç”Ÿèƒ½æºä½”æ¯”ï¼šå¤ªé™½èƒ½ã€é¢¨åŠ›ã€åœ°ç†±ã€æ°´åŠ›ã€æ½®æ±ã€ç”Ÿè³ªèƒ½
  const renewableKeywords = ["å¤ªé™½", "é¢¨åŠ›", "åœ°ç†±", "æ°´åŠ›", "æ½®æ±", "ç”Ÿè³ª"];
  const renewableEnergy = d3.sum(allData.filter(d => 
    d.Source && renewableKeywords.some(keyword => d.Source.includes(keyword))
  ), d => +d["Value(kKLOE)"]);
  
  const coalPercent = totalEnergy > 0 ? ((coalEnergy / totalEnergy) * 100).toFixed(1) : 0;
  const renewablePercent = totalEnergy > 0 ? ((renewableEnergy / totalEnergy) * 100).toFixed(1) : 0;

  // æ›´æ–°çµ±è¨ˆé¡¯ç¤º
  d3.select("#totalEnergy").text(totalEnergy.toLocaleString());
  d3.select("#coalPercent").text(coalPercent + "%");
  d3.select("#renewablePercent").text(renewablePercent + "%");

  const graphData = buildSankeyData(currentData);
  
  d3.select("#debug-nodes").text(graphData.nodes.length);
  d3.select("#debug-links").text(graphData.links.length);
  
  // æ‰‹å‹•è¨­å®š x ä½ç½®ç¢ºä¿åˆ†å±¤å°é½Š
  const layerX = {
    0: 150,              // èƒ½æºä¾†æº
    1: width / 2,        // ä¸­é–“å±¤ï¼ˆç³»çµ±ï¼‰
    2: width - 250       // éƒ¨é–€ï¼ˆå¢åŠ å³å´ç•™ç™½ï¼‰
  };
  
  graphData.nodes.forEach(n => {
    n.fixedX = layerX[n.layer];
  });
  
  const sankeyData = sankey(graphData);
  
  // å¼·åˆ¶ä¿®æ­£ x ä½ç½®
  sankeyData.nodes.forEach(n => {
    const targetX = layerX[n.layer];
    n.x0 = targetX;
    n.x1 = targetX + 20; // nodeWidth
  });

  // Links
  svg.append("g")
    .attr("fill", "none")
    .selectAll("path")
    .data(sankeyData.links)
    .join("path")
    .attr("d", d3.sankeyLinkHorizontal())
    .attr("stroke", d => "#aaa")
    .attr("stroke-width", d => Math.max(1, d.width))
    .attr("class", "link");

  // Nodes
  const node = svg.append("g")
    .selectAll("g")
    .data(sankeyData.nodes)
    .join("g")
    .attr("class", "node");

  node.append("rect")
    .attr("x", d => d.x0)
    .attr("y", d => d.y0)
    .attr("height", d => d.y1 - d.y0)
    .attr("width", d => d.x1 - d.x0)
    .attr("fill", d => colorMap[d.name] || d3.schemeCategory10[d.index % 10])
    .on("mousemove", (event, d) => {
      const currentVal = d3.sum(currentData.filter(row => row.Source === d.name || row.Target === d.name),
                               r => +r["Value(kKLOE)"]);
      const prevVal = d3.sum(prevData.filter(row => row.Source === d.name || row.Target === d.name),
                             r => +r["Value(kKLOE)"]);
      const change = prevVal ? (((currentVal - prevVal) / prevVal) * 100).toFixed(1) : "N/A";
      tooltip
        .style("display", "block")
        .style("left", (event.pageX + 15) + "px")
        .style("top", (event.pageY + 15) + "px")
        .html(`
          <strong>${d.name}</strong><br/>
          ${year} ç¸½é‡ï¼š${currentVal.toLocaleString()} kKLOE<br/>
          èˆ‡å‰ä¸€å¹´è®ŠåŒ–ï¼š${change === "N/A" ? "ç„¡è³‡æ–™" : (change > 0 ? `å¢åŠ  ${change}%` : `ä¸‹é™ ${Math.abs(change)}%`)}
        `);
    })
    .on("mouseout", () => tooltip.style("display", "none"));

  node.append("text")
    .attr("x", d => d.x0 - 6)
    .attr("y", d => (d.y1 + d.y0) / 2)
    .attr("dy", "0.35em")
    .attr("text-anchor", "end")
    .text(d => d.name)
    .style("pointer-events", "all")
    .style("cursor", "pointer")
    .filter(d => d.x0 < width / 2)
    .attr("x", d => d.x1 + 6)
    .attr("text-anchor", "start")
    .on("mousemove", function(event, d) {
      const currentVal = d3.sum(currentData.filter(row => row.Source === d.name || row.Target === d.name),
                               r => +r["Value(kKLOE)"]);
      const prevVal = d3.sum(prevData.filter(row => row.Source === d.name || row.Target === d.name),
                             r => +r["Value(kKLOE)"]);
      const change = prevVal ? (((currentVal - prevVal) / prevVal) * 100).toFixed(1) : "N/A";
      tooltip
        .style("display", "block")
        .style("left", (event.pageX + 15) + "px")
        .style("top", (event.pageY + 15) + "px")
        .html(`
          <strong>${d.name}</strong><br/>
          ${year} ç¸½é‡ï¼š${currentVal.toLocaleString()} kKLOE<br/>
          èˆ‡å‰ä¸€å¹´è®ŠåŒ–ï¼š${change === "N/A" ? "ç„¡è³‡æ–™" : (change > 0 ? `å¢åŠ  ${change}%` : `ä¸‹é™ ${Math.abs(change)}%`)}
        `);
    })
    .on("mouseout", () => tooltip.style("display", "none"));
}

d3.select("#yearSlider").on("input", function() {
  updateChart(+this.value);
});

loadAllCSV();
</script>

</body>
</html>
